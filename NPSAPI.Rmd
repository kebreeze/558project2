---
title: "National Parks API Vignette"
author: "Kelley Breeze"
date: "2022-09-22"
output: 
  html_document: 
    toc: yes 
    toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Requirements

```{r}
library(jsonlite)
library(tidyverse)
```


# National Parks Service API


This function allows user to access the `campgrounds` endpoint on the National Parks Service API. They can specify two arguments, one for `stateAbbreviation` and a second for `limitResultsTo`. If no information is entered for these, the default will return information for all states and limit the results to 40.

```{r}
getCampgrounds<- function(stateAbbreviation="", limitResultsTo="40"){
  baseURL<-"https://developer.nps.gov/api/v1/campgrounds?"
  
  state<- paste0("stateCode=", stateAbbreviation=stateAbbreviation)
  
  limit<- paste0("limit=", limitResultsTo=limitResultsTo)
  
  searchURL<- paste0(baseURL,state,"&", limit, "&", apiKey)
  
  campgrounds<- fromJSON(searchURL)
  
  return(as_tibble(campgrounds$data))
  }

```


## Reformatting Variables

The data from the API needs some reformatting before it can be used for our analysis. All data was read in as character data, so here we are coercing some of this data to numeric. We are also creating a new variable for campground size (small, medium, or large) as well as creating new variables for `cellService` and `campStore` that will be factors.
```{r}
cleaningData<- function(campSizeOutput, characterVector){
  CampgroundData<- campSizeOutput%>%
    mutate(
      boatOrWalk = (as.numeric(campsites$walkBoatTo)),
      RVonly = (as.numeric(campsites$rvOnly)),
      electric = (as.numeric(campsites$electricalHookups)),
      reservable = (as.numeric(numberOfSitesReservable)),
      noReservation = (as.numeric(numberOfSitesFirstComeFirstServe)),
      cellService = (as.factor(amenities$cellPhoneReception)),
      campStore = (as.factor(amenities$campStore)),
      totalSites = (as.numeric(campsites$totalSites)),
      campgroundSize = if_else(totalSites>100, "large",
                         if_else(totalSites>50, "medium", "small"))
      )
    
  return(CampgroundData)
}
```



Create a new numeric variable for `totalSites` from the previous character vector `campsites$totalSites`. Using the new `totalSites` variable, create a new campsite size variable `campgroundSize` that classifies campsites as small if there are fewer than 50 campsites, medium if there are between 50 and 100 campsites, and large if there are more that 100 campsites.
```{r}
campSize<- function(outputgetCampgrounds){
  campgroundSize<- outputgetCampgrounds%>%
      mutate(
    totalSites = (as.numeric(campsites$totalSites)
  ),
  campgroundSize = if_else(totalSites>100, "large",
                         if_else(totalSites>50, "medium", "small")))

  return(campgroundSize)
}


```


Test `getCampgrounds()` function with user specifications of `stateAbbreviation` of `CA` and `limitResultsTo` of `30`.

```{r}
testCampResultsCA100<-getCampgrounds(stateAbbreviation = "CA", limitResultsTo = "100")

#CAcamp<-testCampResultsCA100%>%
#  mutate(
#    sites = as.numeric(numberOfSitesReservable)
#  )


#totalSites<- testCampResultsCA100%>%
#  mutate(
#    totalSites = as.numeric(campsites$totalSites)
#  )
```




# Data Exploration



## Numerical Summaries
We are going to look at some numeric summaries related to our campsite data. 

```{r}
CAnum<-cleaningData(testCampResultsCA100)
```

### Contingency Tables

```{r}
table(CAnum$amenities$firewoodForSale, CAnum$campStore)
```



Looking at total sites and electrical hookups
```{r}
plot1<- ggplot(CAnum, aes(x=totalSites, y=reservable, color=cellService)) + 
  geom_point(position = "jitter") + 
  facet_wrap(~campStore)

plot1
```

